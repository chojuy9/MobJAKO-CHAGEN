<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>모브 캐릭터 생성기</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 나머지 스타일은 이전과 동일 */
        /* ... */
    </style>
</head>
<body>
    <div class="container" id="app-container">
        <div class="loading">
            <div class="loading-spinner"></div>
            데이터를 불러오는 중입니다...
        </div>
    </div>

    <script>
        // 캐릭터 데이터베이스 객체
        let characterDB = {
            koreanMaleNames: [],
            koreanFemaleNames: [],
            englishMaleNames: [],
            englishFemaleNames: [],
            ages: [],
            personalities: [],
            traits: [],
            appearance: {
                height: [],
                hairLength: [],
                hairColor: [],
                hairStyle: [],
                eyeColor: [],
                chestSize: [],
                build: []
            }
        };

        // 현재 캐릭터 데이터
        let currentCharacter = null;

        // 모든 데이터 로드 함수
        async function loadAllData() {
            try {
                // 이름 데이터 로드
                const koreanMaleResponse = await fetch('data/names/korean_male_names.json');
                const koreanFemaleResponse = await fetch('data/names/korean_female_names.json');
                const englishMaleResponse = await fetch('data/names/english_male_names.json');
                const englishFemaleResponse = await fetch('data/names/english_female_names.json');
                
                // 기본 속성 데이터 로드
                const agesResponse = await fetch('data/ages.json');
                const personalitiesResponse = await fetch('data/personalities.json');
                const traitsResponse = await fetch('data/traits.json');
                
                // 외모 속성 데이터 로드
                const heightResponse = await fetch('data/appearances/height.json');
                const hairLengthResponse = await fetch('data/appearances/hair_length.json');
                const hairColorResponse = await fetch('data/appearances/hair_color.json');
                const hairStyleResponse = await fetch('data/appearances/hair_style.json');
                const eyeColorResponse = await fetch('data/appearances/eye_color.json');
                const chestSizeResponse = await fetch('data/appearances/chest_size.json');
                const buildResponse = await fetch('data/appearances/build.json');
                
                // 응답을 JSON으로 변환
                const koreanMaleData = await koreanMaleResponse.json();
                const koreanFemaleData = await koreanFemaleResponse.json();
                const englishMaleData = await englishMaleResponse.json();
                const englishFemaleData = await englishFemaleResponse.json();
                
                const agesData = await agesResponse.json();
                const personalitiesData = await personalitiesResponse.json();
                const traitsData = await traitsResponse.json();
                
                const heightData = await heightResponse.json();
                const hairLengthData = await hairLengthResponse.json();
                const hairColorData = await hairColorResponse.json();
                const hairStyleData = await hairStyleResponse.json();
                const eyeColorData = await eyeColorResponse.json();
                const chestSizeData = await chestSizeResponse.json();
                const buildData = await buildResponse.json();
                
                // 데이터베이스 객체에 데이터 저장
                characterDB.koreanMaleNames = koreanMaleData.names;
                characterDB.koreanFemaleNames = koreanFemaleData.names;
                characterDB.englishMaleNames = englishMaleData.names;
                characterDB.englishFemaleNames = englishFemaleData.names;
                
                characterDB.ages = agesData.ages;
                characterDB.personalities = personalitiesData.personalities;
                characterDB.traits = traitsData.traits;
                
                characterDB.appearance.height = heightData.height;
                characterDB.appearance.hairLength = hairLengthData.hair_length;
                characterDB.appearance.hairColor = hairColorData.hair_color;
                characterDB.appearance.hairStyle = hairStyleData.hair_style;
                characterDB.appearance.eyeColor = eyeColorData.eye_color;
                characterDB.appearance.chestSize = chestSizeData.chest_size;
                characterDB.appearance.build = buildData.build;
                
                console.log('모든 캐릭터 데이터 로드 완료!');
                return true;
            } catch (error) {
                console.error('데이터 로드 중 오류 발생:', error);
                return false;
            }
        }

        // 페이지 로딩 시 데이터 로드 후 UI 초기화
        document.addEventListener('DOMContentLoaded', async function() {
            const container = document.getElementById('app-container');
            
            // 데이터 로드
            const loadSuccess = await loadAllData();
            
            if (loadSuccess) {
                // 데이터 로드 성공 시 UI 초기화
                initializeUI();
            } else {
                // 데이터 로드 실패 시 오류 메시지
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h2>데이터 로드 실패</h2>
                        <p>데이터를 불러오는 데 실패했습니다. 페이지를 새로고침해 주세요.</p>
                        <button onclick="location.reload()">새로고침</button>
                    </div>
                `;
            }
        });

        // UI 초기화 함수
        function initializeUI() {
            const container = document.getElementById('app-container');
            
            // UI HTML 생성
            container.innerHTML = `
                <h1>모브 캐릭터 생성기</h1>
                
                <div class="filter-section">
                    <div class="filter-title">캐릭터 필터 설정</div>
                    <div class="filter-options">
                        <div class="filter-group">
                            <label>성별:</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="gender" value="random" checked> 랜덤
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="gender" value="male"> 남성
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="gender" value="female"> 여성
                                </label>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>이름 언어:</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="name-language" value="random" checked> 랜덤
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="name-language" value="korean"> 한국어
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="name-language" value="english"> 영어
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="character-attributes">
                    <div class="attribute">
                        <div class="attribute-label">이름:</div>
                        <div class="attribute-value" id="name-value">-</div>
                    </div>
                    
                    <div class="attribute">
                        <div class="attribute-label">나이:</div>
                        <div class="attribute-value" id="age-value">-</div>
                    </div>
                    
                    <div class="attribute">
                        <div class="attribute-label">성별:</div>
                        <div class="attribute-value" id="gender-value">-</div>
                    </div>
                    
                    <div class="attribute">
                        <div class="attribute-label">외모:</div>
                        <div class="attribute-value" id="appearance-value">-</div>
                    </div>
                    
                    <div class="attribute">
                        <div class="attribute-label">성격:</div>
                        <div class="attribute-value" id="personality-value">-</div>
                    </div>
                    
                    <div class="attribute">
                        <div class="attribute-label">특징:</div>
                        <div class="attribute-value" id="trait-value">-</div>
                    </div>
                </div>
                
                <button id="generate-btn">캐릭터 생성하기</button>
            `;
            
            // 이벤트 리스너 추가
            document.getElementById('generate-btn').addEventListener('click', generateCharacter);
            
            // 첫 캐릭터 생성
            generateCharacter();
        }

        // 이름 선택 함수
        function getFilteredName(gender, nameLanguage) {
            // 성별과 언어에 따라 적절한 이름 배열 선택
            let nameArray;
            
            if (nameLanguage === 'korean') {
                nameArray = (gender === 'male') ? characterDB.koreanMaleNames : characterDB.koreanFemaleNames;
            } else {
                nameArray = (gender === 'male') ? characterDB.englishMaleNames : characterDB.englishFemaleNames;
            }
            
            // 랜덤 이름 선택
            return getRandomItem(nameArray);
        }

        // 외모 속성 필터링 함수
        function getFilteredAppearanceItem(items, gender) {
            // 성별에 맞는 항목만 필터링
            let filteredItems = items.filter(item => 
                item.tags.includes(gender) || 
                (gender === 'male' && item.tags.includes('male_rare'))
            );
            
            // 필터링된 항목이 없으면 모든 항목에서 선택
            if (filteredItems.length === 0) {
                filteredItems = items;
            }
            
            // 랜덤 선택
            return filteredItems[Math.floor(Math.random() * filteredItems.length)].value;
        }

        // 캐릭터 생성 함수
        function generateCharacter() {
            // 선택된 성별 가져오기
            const selectedGender = document.querySelector('input[name="gender"]:checked').value;
            
            // 선택된 이름 언어 가져오기
            const selectedNameLang = document.querySelector('input[name="name-language"]:checked').value;
            
            // 성별 결정 (랜덤 옵션 처리)
            const gender = (selectedGender === 'random') ? 
                (Math.random() < 0.5 ? 'male' : 'female') : selectedGender;
            
            // 이름 언어 결정 (랜덤 옵션 처리)
            const nameLanguage = (selectedNameLang === 'random') ?
                (Math.random() < 0.5 ? 'korean' : 'english') : selectedNameLang;
            
            // 이름 선택
            const name = getFilteredName(gender, nameLanguage);
            
            // 나머지 속성 생성
            const age = getRandomItem(characterDB.ages);
            const personality = getRandomItem(characterDB.personalities);
            const trait = getRandomItem(characterDB.traits);
            
            // 외모 생성 (실제 구현시 더 많은 속성 조합)
            const height = getFilteredAppearanceItem(characterDB.appearance.height, gender);
            const hairColor = getFilteredAppearanceItem(characterDB.appearance.hairColor, gender);
            const hairLength = getFilteredAppearanceItem(characterDB.appearance.hairLength, gender);
            const hairStyle = getFilteredAppearanceItem(characterDB.appearance.hairStyle, gender);
            const eyeColor = getFilteredAppearanceItem(characterDB.appearance.eyeColor, gender);
            const build = getFilteredAppearanceItem(characterDB.appearance.build, gender);
            
            // 외모 설명 조합 (성별에 따라 다르게)
            let appearance;
            if (gender === 'male') {
                appearance = `${height}에 ${build} 체형, ${hairLength} ${hairColor} ${hairStyle} 머리, ${eyeColor} 눈동자`;
            } else {
                const chestSize = getFilteredAppearanceItem(characterDB.appearance.chestSize, gender);
                appearance = `${height}에 ${build} 체형, ${hairLength} ${hairColor} ${hairStyle} 머리, ${eyeColor} 눈동자, ${chestSize} 가슴`;
            }
            
            // 현재 캐릭터 데이터 저장
            currentCharacter = {
                name: name,
                age: age,
                gender: gender === 'male' ? '남성' : '여성',
                nameLanguage: nameLanguage,
                appearance: appearance,
                personality: personality,
                trait: trait
            };
            
            // UI 업데이트
            updateCharacterDisplay();
        }

        // 캐릭터 표시 업데이트
        function updateCharacterDisplay() {
            if (!currentCharacter) return;
            
            document.getElementById('name-value').textContent = currentCharacter.name;
            document.getElementById('age-value').textContent = currentCharacter.age;
            document.getElementById('gender-value').textContent = currentCharacter.gender;
            document.getElementById('appearance-value').textContent = currentCharacter.appearance;
            document.getElementById('personality-value').textContent = currentCharacter.personality;
            document.getElementById('trait-value').textContent = currentCharacter.trait;
        }

        // 랜덤 항목 선택 함수
        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }
    </script>
</body>
</html>